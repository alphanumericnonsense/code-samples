# LFSR math

Let $F=GF(2)[x]/(m(x))$ with $m(x)=\sum_{i=0}^dm_ix^i\in GF(2)[x]$ irreducible.  The matrix of multiplication by $x$ (acting on the left) with respect to the polynomial basis $\{1,x,x^2,\ldots,x^{d-1}\}$ is

$$
M_x=\left(
\begin{array}{ccccc}
0&0&0&\cdots&0 &m_0\\
1&0&0&\cdots&0 &m_1\\
0&1&0&\cdots&0 &m_2\\
&&\ddots&&&\vdots\\
0&0&0&\cdots&1&m_{d-1}\\
\end{array}
\right).
$$

This defines a dynamical system on $F$ (or $GF(2)^d$),

$$
M_xv=(m_0v_d, v_0+m_1v_d, \ldots, v_{d-1}+m_{d-1}v_d)^t, \quad v\in GF(2)^d.
$$

If $m(x)$ is *primitive*, i.e. $x$ generates the multiplicative group of $F$,  then there are two orbits, namely $\{0\}$ and $F^{\times}$.

If we instead we consider the action of the transpose, $M_x^t$, we obtain a simpler but equivalent dynamical system (a matrix over a field is similar to its transpose), namely a linear feedback shift register:

$$
M_x^tv=\left(v_1,v_2,\ldots, v_{d-1}, \sum_{i=0}^{d-1}m_iv_i\right)^t.
$$

Here we shift the coordinates of $v$ and tack on a new bit $\langle m,v\rangle$.  A primitive LFSR gives a simple device to produce large pseudorandom strings.  E.g. this length 8 LFSR (using 8-bit integers as vectors) with initial vector 1

```python
def dot(m, v, l):
    a = m & v # pointwise product
    r = 0
    for i in range(l): # xor the bits
        r ^= a & 1
        a >>= 1
    return r

def LFSR(v, m = 1 + 2 + 4 + 2**7):
    r = (v << 1) & (2**8 - 1) # shift
    r = r ^ dot(m, v, 8) # new bit
    return r

v = 1
L = []
for i in range(255):
    L.append(v)
    v = LFSR(v)
print(L)
for l in L:
    print(bin(l))
```

produces the sequence

```
[1, 3, 6, 12, 25, 51, 102, 204, 152, 49, 99, 198, 141, 27, 54, 108, 217, 178, 100, 201, 146, 36, 73, 147, 39, 79, 159, 62, 124, 249, 242, 228, 200, 145, 34, 69, 138, 20, 41, 83, 166, 77, 154, 52, 105, 211, 167, 78, 156, 56, 112, 224, 193, 130, 4, 9, 19, 38, 76, 153, 50, 101, 202, 148, 40, 80, 160, 65, 131, 7, 15, 31, 63, 127, 255, 254, 253, 251, 247, 238, 221, 187, 119, 239, 222, 189, 123, 246, 237, 219, 183, 110, 220, 184, 113, 227, 199, 142, 29, 58, 117, 234, 212, 168, 81, 163, 71, 143, 30, 60, 121, 243, 231, 206, 157, 59, 118, 236, 216, 177, 98, 197, 139, 23, 47, 95, 191, 126, 252, 248, 241, 226, 196, 136, 17, 35, 70, 140, 24, 48, 96, 192, 129, 2, 5, 10, 21, 42, 85, 170, 84, 169, 82, 165, 75, 150, 45, 90, 181, 107, 214, 173, 91, 182, 109, 218, 180, 104, 208, 161, 66, 133, 11, 22, 44, 89, 179, 103, 207, 158, 61, 122, 245, 235, 215, 174, 93, 186, 116, 233, 210, 164, 72, 144, 33, 67, 134, 13, 26, 53, 106, 213, 171, 87, 175, 94, 188, 120, 240, 225, 194, 132, 8, 16, 32, 64, 128, 1, 3, 6, 12, 25, 51, 102, 204, 152, 49, 99, 198, 141, 27, 54, 108, 217, 178, 100, 201, 146, 36, 73, 147, 39, 79, 159, 62, 124, 249, 242, 228, 200, 145, 34, 69, 138, 20]
```

i.e.

```
00000001
00000011
00000110
00001100
00011001
00110011
01100110
11001100
10011000
00110001
01100011
11000110
10001101
00011011
00110110
01101100
11011001
10110010
01100100
11001001
10010010
00100100
01001001
10010011
00100111
01001111
10011111
00111110
01111100
11111001
11110010
11100100
11001000
10010001
00100010
01000101
10001010
00010100
00101001
01010011
10100110
01001101
10011010
00110100
01101001
11010011
10100111
01001110
10011100
00111000
01110000
11100000
11000001
10000010
00000100
00001001
00010011
00100110
01001100
10011001
00110010
01100101
11001010
10010100
00101000
01010000
10100000
01000001
10000011
00000111
00001111
00011111
00111111
01111111
11111111
11111110
11111101
11111011
11110111
11101110
11011101
10111011
01110111
11101111
11011110
10111101
01111011
11110110
11101101
11011011
10110111
01101110
11011100
10111000
01110001
11100011
11000111
10001110
00011101
00111010
01110101
11101010
11010100
10101000
01010001
10100011
01000111
10001111
00011110
00111100
01111001
11110011
11100111
11001110
10011101
00111011
01110110
11101100
11011000
10110001
01100010
11000101
10001011
00010111
00101111
01011111
10111111
01111110
11111100
11111000
11110001
11100010
11000100
10001000
00010001
00100011
01000110
10001100
00011000
00110000
01100000
11000000
10000001
00000010
00000101
00001010
00010101
00101010
01010101
10101010
01010100
10101001
01010010
10100101
01001011
10010110
00101101
01011010
10110101
01101011
11010110
10101101
01011011
10110110
01101101
11011010
10110100
01101000
11010000
10100001
01000010
10000101
00001011
00010110
00101100
01011001
10110011
01100111
11001111
10011110
00111101
01111010
11110101
11101011
11010111
10101110
01011101
10111010
01110100
11101001
11010010
10100100
01001000
10010000
00100001
01000011
10000110
00001101
00011010
00110101
01101010
11010101
10101011
01010111
10101111
01011110
10111100
01111000
11110000
11100001
11000010
10000100
00001000
00010000
00100000
01000000
10000000
00000001
00000011
00000110
00001100
00011001
00110011
01100110
11001100
10011000
00110001
01100011
11000110
10001101
00011011
00110110
01101100
11011001
10110010
01100100
11001001
10010010
00100100
01001001
10010011
00100111
01001111
10011111
00111110
01111100
11111001
11110010
11100100
11001000
10010001
00100010
01000101
10001010
00010100
```

